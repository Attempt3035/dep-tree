name: Test/Tag
on:
  pull_request:
  push:
    branches:
      - main
jobs:
  unit-test:
    if: ${{ !startsWith(github.event.head_commit.message, 'tag') }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/setup-go
      - name: Test
        run: go test -v -covermode=count -coverprofile=.coverage.out ./...
      - name: Coveralls upload
        uses: shogo82148/actions-goveralls@v1
        with:
          path-to-profile: .coverage.out

